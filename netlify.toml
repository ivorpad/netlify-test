
[build]
command = "node context.js && npm run build"
publish = ".next"
functions = "functions"

# Production context:
# All deploys from the main repository branch
# will inherit these settings.
[context.production]
  [context.production.environment]
    NEXT_PUBLIC_CONTEXT = "production"
    NEXT_PUBLIC_ACCESS_TOKEN = "not so secret for prod"
  # Deploys from main branch run this plugin in the build.
  # Plugins context requires double brackets.

# Deploy Preview context:
# All deploys generated from a pull/merge request
# will inherit these settings.
[context.deploy-preview]
  command = "sed -i \"s/SELF_URL_PLACEHOLDER/${DEPLOY_URL}/g\" netlify.toml && npm run build"

[context.deploy-preview.environment]
  ACCESS_TOKEN = "not so secret"
  NEXT_PUBLIC_ACCESS_TOKEN = "not so secret"
  NEXT_PUBLIC_SELF_URL = "SELF_URL_PLACEHOLDER"
  NEXT_PUBLIC_CONTEXT = "deploy-preview"